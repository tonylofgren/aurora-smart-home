# Generated by esphome@aurora-smart-home v1.0.0
# https://github.com/tonylofgren/aurora-smart-home
#
# Smart Room Multi-Sensor
# -----------------------
# ESP32-S3 based room sensor with:
# - mmWave presence detection (LD2410)
# - Temperature & humidity (SHT31)
# - Light level (BH1750)
# - Addressable LED strip control
#
# Hardware:
#   - ESP32-S3-DevKitC-1 (or similar)
#   - LD2410 mmWave radar (UART)
#   - SHT31 temperature/humidity (I2C)
#   - BH1750 light sensor (I2C)
#   - WS2812B LED strip

substitutions:
  device_name: "smart-room-sensor"
  friendly_name: "Smart Room Sensor"
  room_name: "Office"

  # I2C pins
  sda_pin: "GPIO21"
  scl_pin: "GPIO22"

  # LD2410 UART pins
  radar_tx_pin: "GPIO17"
  radar_rx_pin: "GPIO18"

  # LED strip
  led_pin: "GPIO48"
  num_leds: "60"

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}
  platformio_options:
    board_build.flash_mode: dio

esp32:
  board: esp32-s3-devkitc-1
  framework:
    type: esp-idf

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  power_save_mode: none

  ap:
    ssid: "${device_name}-fallback"

api:
  encryption:
    key: !secret api_encryption_key

ota:
  - platform: esphome
    password: !secret ota_password

logger:
  level: INFO

# =============================================================================
# I2C Bus
# =============================================================================

i2c:
  sda: ${sda_pin}
  scl: ${scl_pin}
  scan: true

# =============================================================================
# UART for LD2410
# =============================================================================

uart:
  id: uart_ld2410
  tx_pin: ${radar_tx_pin}
  rx_pin: ${radar_rx_pin}
  baud_rate: 256000
  parity: NONE
  stop_bits: 1

ld2410:
  id: ld2410_radar
  uart_id: uart_ld2410

# =============================================================================
# Sensors
# =============================================================================

sensor:
  # Temperature & Humidity (SHT31)
  - platform: sht3xd
    temperature:
      name: "${room_name} Temperature"
      id: room_temperature
      filters:
        - offset: -1.5  # Calibration offset
    humidity:
      name: "${room_name} Humidity"
      id: room_humidity
    address: 0x44
    update_interval: 30s

  # Light Level (BH1750)
  - platform: bh1750
    name: "${room_name} Light Level"
    id: room_light_level
    address: 0x23
    update_interval: 10s

  # LD2410 Detection Distance
  - platform: ld2410
    moving_distance:
      name: "${room_name} Moving Distance"
    still_distance:
      name: "${room_name} Still Distance"
    detection_distance:
      name: "${room_name} Detection Distance"

  # WiFi Signal
  - platform: wifi_signal
    name: "${room_name} Sensor WiFi"
    update_interval: 60s
    entity_category: diagnostic

  # Uptime
  - platform: uptime
    name: "${room_name} Sensor Uptime"
    entity_category: diagnostic

binary_sensor:
  # LD2410 Presence
  - platform: ld2410
    has_target:
      name: "${room_name} Presence"
      id: room_presence
      device_class: occupancy
    has_moving_target:
      name: "${room_name} Motion"
      device_class: motion
    has_still_target:
      name: "${room_name} Still Presence"

  # Status
  - platform: status
    name: "${room_name} Sensor Status"

# =============================================================================
# LED Strip
# =============================================================================

light:
  - platform: esp32_rmt_led_strip
    id: room_led_strip
    name: "${room_name} LED Strip"
    pin: ${led_pin}
    num_leds: ${num_leds}
    rgb_order: GRB
    chipset: WS2812
    rmt_channel: 0

    effects:
      # Solid colors with smooth transition
      - pulse:
          name: "Breathe"
          transition_length: 2s
          update_interval: 2s
          min_brightness: 50%
          max_brightness: 100%

      # Color cycle
      - addressable_rainbow:
          name: "Rainbow"
          speed: 10
          width: 50

      # Relaxing warm pulse
      - pulse:
          name: "Relax"
          transition_length: 4s
          update_interval: 4s
          min_brightness: 30%
          max_brightness: 70%

      # Movie bias lighting
      - addressable_color_wipe:
          name: "Movie"
          colors:
            - red: 20%
              green: 10%
              blue: 5%
              num_leds: ${num_leds}
          add_led_interval: 50ms

# =============================================================================
# Template Sensors for HA
# =============================================================================

text_sensor:
  - platform: version
    name: "${room_name} Sensor ESPHome Version"
    entity_category: diagnostic

  - platform: wifi_info
    ip_address:
      name: "${room_name} Sensor IP"
      entity_category: diagnostic

# =============================================================================
# Buttons
# =============================================================================

button:
  - platform: restart
    name: "${room_name} Sensor Restart"
    entity_category: config

  - platform: ld2410
    restart:
      name: "${room_name} Radar Restart"
      entity_category: config
