# Generated by ha-yaml@aurora-smart-home v1.0.0
# https://github.com/tonylofgren/aurora-smart-home
#
# Smart Room Automations
# ----------------------
# Complete automation set for a smart room with presence-based
# lighting, climate control, and mode management.

# =============================================================================
# Presence-Based Lighting
# =============================================================================

automation:
  - alias: "Office - Presence Light On"
    id: office_presence_light_on
    description: "Turn on lights when presence detected, brightness based on time"
    trigger:
      - platform: state
        entity_id: binary_sensor.office_presence
        to: "on"
    condition:
      # Only if lights are off
      - condition: state
        entity_id: light.office_led_strip
        state: "off"
      # Only if it's dark enough
      - condition: numeric_state
        entity_id: sensor.office_light_level
        below: 100
    action:
      - choose:
          # Morning (6-9): Energizing cool light
          - conditions:
              - condition: time
                after: "06:00:00"
                before: "09:00:00"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: scene.office_work

          # Daytime (9-18): Full brightness
          - conditions:
              - condition: time
                after: "09:00:00"
                before: "18:00:00"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: light.office_led_strip
                data:
                  brightness_pct: 100
                  color_temp_kelvin: 5000

          # Evening (18-22): Warm relaxing light
          - conditions:
              - condition: time
                after: "18:00:00"
                before: "22:00:00"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: scene.office_relax

          # Night (22-6): Dim nightlight
          - conditions:
              - condition: time
                after: "22:00:00"
                before: "06:00:00"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: light.office_led_strip
                data:
                  brightness_pct: 10
                  color_temp_kelvin: 2700

  - alias: "Office - No Presence Light Off"
    id: office_no_presence_light_off
    description: "Turn off lights after 30 minutes without presence"
    trigger:
      - platform: state
        entity_id: binary_sensor.office_presence
        to: "off"
        for:
          minutes: 30
    action:
      - service: light.turn_off
        target:
          entity_id: light.office_led_strip
      - service: input_select.select_option
        target:
          entity_id: input_select.office_mode
        data:
          option: "away"

# =============================================================================
# Climate Control
# =============================================================================

  - alias: "Office - Climate Presence"
    id: office_climate_presence
    description: "Adjust climate when presence changes"
    trigger:
      - platform: state
        entity_id: binary_sensor.office_presence
    action:
      - choose:
          # Presence detected - comfort mode
          - conditions:
              - condition: state
                entity_id: binary_sensor.office_presence
                state: "on"
            sequence:
              - service: climate.set_temperature
                target:
                  entity_id: climate.office
                data:
                  temperature: 22
              - service: climate.set_preset_mode
                target:
                  entity_id: climate.office
                data:
                  preset_mode: "home"

          # No presence - eco mode
          - conditions:
              - condition: state
                entity_id: binary_sensor.office_presence
                state: "off"
                for:
                  minutes: 30
            sequence:
              - service: climate.set_preset_mode
                target:
                  entity_id: climate.office
                data:
                  preset_mode: "away"

  - alias: "Office - Night Climate"
    id: office_night_climate
    description: "Lower temperature at night"
    trigger:
      - platform: time
        at: "22:00:00"
    action:
      - service: climate.set_temperature
        target:
          entity_id: climate.office
        data:
          temperature: 20

# =============================================================================
# Mode Management
# =============================================================================

  - alias: "Office - Mode Changed"
    id: office_mode_changed
    description: "Apply scene when mode changes"
    trigger:
      - platform: state
        entity_id: input_select.office_mode
    action:
      - choose:
          - conditions:
              - condition: state
                entity_id: input_select.office_mode
                state: "work"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: scene.office_work

          - conditions:
              - condition: state
                entity_id: input_select.office_mode
                state: "relax"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: scene.office_relax

          - conditions:
              - condition: state
                entity_id: input_select.office_mode
                state: "movie"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: scene.office_movie

          - conditions:
              - condition: state
                entity_id: input_select.office_mode
                state: "night"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: scene.office_night

          - conditions:
              - condition: state
                entity_id: input_select.office_mode
                state: "away"
            sequence:
              - service: light.turn_off
                target:
                  entity_id: light.office_led_strip
              - service: climate.set_preset_mode
                target:
                  entity_id: climate.office
                data:
                  preset_mode: "away"

# =============================================================================
# Voice Command Integration
# =============================================================================

  - alias: "Office - Voice Set Mode"
    id: office_voice_set_mode
    description: "Handle voice commands for room modes"
    trigger:
      - platform: event
        event_type: assist_action
        event_data:
          action: set_room_mode
    condition:
      - condition: template
        value_template: "{{ trigger.event.data.room == 'office' }}"
    action:
      - service: input_select.select_option
        target:
          entity_id: input_select.office_mode
        data:
          option: "{{ trigger.event.data.mode }}"

# =============================================================================
# Adaptive Lighting Based on Sensor
# =============================================================================

  - alias: "Office - Auto Brightness Adjust"
    id: office_auto_brightness
    description: "Adjust light brightness based on ambient light"
    trigger:
      - platform: state
        entity_id: sensor.office_light_level
    condition:
      - condition: state
        entity_id: light.office_led_strip
        state: "on"
      - condition: state
        entity_id: input_boolean.office_auto_brightness
        state: "on"
    action:
      - service: light.turn_on
        target:
          entity_id: light.office_led_strip
        data:
          brightness_pct: >-
            {% set lux = states('sensor.office_light_level') | float(100) %}
            {% if lux < 50 %}
              100
            {% elif lux < 100 %}
              80
            {% elif lux < 200 %}
              60
            {% else %}
              40
            {% endif %}

# =============================================================================
# Temperature Alerts
# =============================================================================

  - alias: "Office - Temperature Alert"
    id: office_temperature_alert
    description: "Notify if temperature is too high or low"
    trigger:
      - platform: numeric_state
        entity_id: sensor.office_temperature
        above: 28
        id: too_hot
      - platform: numeric_state
        entity_id: sensor.office_temperature
        below: 16
        id: too_cold
    action:
      - service: notify.mobile_app
        data:
          title: "Office Temperature Alert"
          message: >-
            {% if trigger.id == 'too_hot' %}
              Temperature is {{ states('sensor.office_temperature') }}°C - too hot!
            {% else %}
              Temperature is {{ states('sensor.office_temperature') }}°C - too cold!
            {% endif %}
