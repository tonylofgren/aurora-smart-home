# Smart Garage Automations for Home Assistant
# Add these to your automations.yaml or via UI

# =============================================================================
# Auto-Close After Timeout
# =============================================================================

- alias: "Garage - Auto Close After 10 Minutes"
  id: garage_auto_close
  description: "Automatically close garage door if left open"
  trigger:
    - platform: state
      entity_id: cover.garage_door
      to: "open"
      for:
        minutes: 10
  condition:
    # Only auto-close during certain hours (safety)
    - condition: time
      after: "07:00:00"
      before: "22:00:00"
  action:
    - service: notify.notify
      data:
        title: "Garage"
        message: "Garage door has been open for 10 minutes. Closing automatically."
    - delay:
        seconds: 30
    - service: cover.close_cover
      target:
        entity_id: cover.garage_door

# =============================================================================
# Left Open Alert
# =============================================================================

- alias: "Garage - Left Open Alert"
  id: garage_left_open_alert
  description: "Alert if garage door left open at night"
  trigger:
    - platform: time
      at: "22:00:00"
  condition:
    - condition: state
      entity_id: cover.garage_door
      state: "open"
  action:
    - service: notify.notify
      data:
        title: "ðŸš— Garage Alert"
        message: "Garage door is still open at night!"
    - service: persistent_notification.create
      data:
        title: "Garage Door Open"
        message: "The garage door is open. Close it for security."
        notification_id: garage_open_night

# =============================================================================
# Car Arrival/Departure
# =============================================================================

- alias: "Garage - Car Arrived"
  id: garage_car_arrived
  description: "Notification when car arrives home"
  trigger:
    - platform: state
      entity_id: binary_sensor.garage_car_present
      from: "off"
      to: "on"
  condition:
    # Only notify if someone is not already home
    - condition: state
      entity_id: person.owner
      state: "not_home"
  action:
    - service: notify.notify
      data:
        title: "ðŸš— Car Arrived"
        message: "A car has parked in the garage."

- alias: "Garage - Car Left"
  id: garage_car_left
  description: "Notification when car leaves"
  trigger:
    - platform: state
      entity_id: binary_sensor.garage_car_present
      from: "on"
      to: "off"
      for:
        minutes: 2
  action:
    - service: notify.notify
      data:
        title: "ðŸš— Car Left"
        message: "The car has left the garage."

# =============================================================================
# Auto-Open on Arrival (Geofence)
# =============================================================================

# Requires device tracker with GPS (phone, car)
- alias: "Garage - Auto Open on Arrival"
  id: garage_auto_open_arrival
  description: "Open garage when approaching home"
  mode: single
  trigger:
    - platform: zone
      entity_id: device_tracker.your_phone
      zone: zone.home
      event: enter
  condition:
    # Car must not already be in garage
    - condition: state
      entity_id: binary_sensor.garage_car_present
      state: "off"
    # Door must be closed
    - condition: state
      entity_id: cover.garage_door
      state: "closed"
    # Only during reasonable hours
    - condition: time
      after: "06:00:00"
      before: "23:00:00"
  action:
    - service: cover.open_cover
      target:
        entity_id: cover.garage_door
    - service: notify.notify
      data:
        title: "Garage"
        message: "Welcome home! Opening garage door."

# =============================================================================
# Motion-Activated Light (Example)
# =============================================================================

- alias: "Garage - Motion Light"
  id: garage_motion_light
  description: "Turn on garage light on motion"
  trigger:
    - platform: state
      entity_id: binary_sensor.garage_motion
      to: "on"
  action:
    - service: light.turn_on
      target:
        entity_id: light.garage  # Your garage light entity
    - delay:
        minutes: 5
    - service: light.turn_off
      target:
        entity_id: light.garage

# =============================================================================
# Temperature Alert
# =============================================================================

- alias: "Garage - Freeze Warning"
  id: garage_freeze_warning
  description: "Alert if garage temperature drops below freezing"
  trigger:
    - platform: numeric_state
      entity_id: sensor.garage_temperature
      below: 2
  action:
    - service: notify.notify
      data:
        title: "ðŸ¥¶ Garage Freeze Warning"
        message: "Garage temperature is {{ states('sensor.garage_temperature') }}Â°C - protect sensitive items!"

# =============================================================================
# Door State Changed
# =============================================================================

- alias: "Garage - Door Opened"
  id: garage_door_opened
  description: "Log and notify when garage door opens"
  trigger:
    - platform: state
      entity_id: cover.garage_door
      to: "open"
  action:
    - service: logbook.log
      data:
        name: "Garage Door"
        message: "opened"
        entity_id: cover.garage_door

- alias: "Garage - Door Closed"
  id: garage_door_closed
  description: "Clear notifications when door closes"
  trigger:
    - platform: state
      entity_id: cover.garage_door
      to: "closed"
  action:
    - service: persistent_notification.dismiss
      data:
        notification_id: garage_open_night
