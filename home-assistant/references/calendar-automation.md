# Calendar Automation

Guide f√∂r att automatisera baserat p√• kalenderdata i Home Assistant.

## √ñversikt

Kalenderautomation m√∂jligg√∂r:
- Schemal√§ggning via kalender ist√§llet f√∂r YAML
- Integration med Google Calendar, CalDAV, etc.
- Dynamiska scheman som enkelt √§ndras
- Semester- och helghantering

## Kalenderplattformar

| Platform | Beskrivning | Lokal |
|----------|-------------|-------|
| Local Calendar | Inbyggd HA-kalender | ‚úÖ Ja |
| Google Calendar | Google-integration | ‚ùå Nej |
| CalDAV | iCloud, Nextcloud, etc. | Beror p√• |
| ICS | iCal-filer | ‚úÖ Ja |
| Waste Collection | Soph√§mtning | ‚úÖ Ja |

## Local Calendar

### Skapa Lokal Kalender

Settings ‚Üí Devices & Services ‚Üí Add Integration ‚Üí Local Calendar

```yaml
# Automatiskt skapad entity:
# calendar.mitt_schema
```

### L√§gg till Event via Tj√§nst

```yaml
# Generated by ha-yaml@aurora-smart-home v1.0.0
# https://github.com/tonylofgren/aurora-smart-home

automation:
  - alias: "L√§gg till semester"
    id: add_vacation_event
    trigger:
      - platform: state
        entity_id: input_boolean.vacation_mode
        to: "on"
    action:
      - service: calendar.create_event
        target:
          entity_id: calendar.semester
        data:
          summary: "Semester"
          start_date: "{{ now().date().isoformat() }}"
          end_date: "{{ (now() + timedelta(days=7)).date().isoformat() }}"
```

## Calendar Trigger

### Grundl√§ggande Calendar Trigger

```yaml
automation:
  - alias: "Kalender - Event startar"
    id: calendar_event_start
    trigger:
      - platform: calendar
        entity_id: calendar.arbetsschema
        event: start
    action:
      - service: switch.turn_on
        target:
          entity_id: switch.office_lights
      - service: climate.set_temperature
        target:
          entity_id: climate.office
        data:
          temperature: 22
```

### Event Slutar

```yaml
automation:
  - alias: "Kalender - Event slutar"
    id: calendar_event_end
    trigger:
      - platform: calendar
        entity_id: calendar.arbetsschema
        event: end
    action:
      - service: switch.turn_off
        target:
          entity_id: switch.office_lights
      - service: climate.set_preset_mode
        target:
          entity_id: climate.office
        data:
          preset_mode: away
```

### Offset Trigger

Trigga f√∂re/efter event:

```yaml
automation:
  - alias: "Kalender - 30 min f√∂re m√∂te"
    id: calendar_before_meeting
    trigger:
      - platform: calendar
        entity_id: calendar.arbete
        event: start
        offset: "-00:30:00"  # 30 minuter f√∂re
    condition:
      - condition: template
        value_template: "{{ 'm√∂te' in trigger.calendar_event.summary.lower() }}"
    action:
      - service: notify.mobile_app_tonys_iphone
        data:
          title: "M√∂te snart"
          message: "{{ trigger.calendar_event.summary }} b√∂rjar om 30 minuter"
```

## Trigger Data

Tillg√§nglig data i `trigger.calendar_event`:

```yaml
automation:
  - alias: "Kalender - Visa eventdata"
    id: calendar_event_data
    trigger:
      - platform: calendar
        entity_id: calendar.hem
        event: start
    action:
      - service: notify.mobile_app_tonys_iphone
        data:
          title: "{{ trigger.calendar_event.summary }}"
          message: >
            Start: {{ trigger.calendar_event.start }}
            Slut: {{ trigger.calendar_event.end }}
            Beskrivning: {{ trigger.calendar_event.description | default('Ingen') }}
            Plats: {{ trigger.calendar_event.location | default('Ingen') }}
```

## Villkorskontroll med Kalender

### State-baserad

```yaml
automation:
  - alias: "Bara p√• arbetstid"
    id: only_work_hours
    trigger:
      - platform: state
        entity_id: binary_sensor.motion
        to: "on"
    condition:
      # Kontrollera om det finns aktivt event
      - condition: state
        entity_id: calendar.arbetsschema
        state: "on"
    action:
      - service: light.turn_on
        target:
          entity_id: light.office
```

### Template-baserad

```yaml
automation:
  - alias: "Kontrollera specifikt event"
    id: check_specific_event
    trigger:
      - platform: time_pattern
        minutes: "/30"
    condition:
      - condition: template
        value_template: >
          {% set cal = state_attr('calendar.arbetsschema', 'message') %}
          {{ cal is not none and 'hemarbete' in cal.lower() }}
    action:
      - service: light.turn_on
        target:
          entity_id: light.office
```

## Semesterl√§ge

### Automatisk Semester fr√•n Kalender

```yaml
automation:
  - alias: "Semester - Aktivera"
    id: vacation_start
    trigger:
      - platform: calendar
        entity_id: calendar.semester
        event: start
    action:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.vacation_mode
      - service: climate.set_preset_mode
        target:
          entity_id: all
        data:
          preset_mode: away
      - service: notify.all_phones
        data:
          title: "Semesterl√§ge aktiverat"
          message: "Huset √§r nu i semesterl√§ge"

  - alias: "Semester - Avaktivera"
    id: vacation_end
    trigger:
      - platform: calendar
        entity_id: calendar.semester
        event: end
    action:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.vacation_mode
      - service: climate.set_preset_mode
        target:
          entity_id: all
        data:
          preset_mode: home
```

## Arbetsschema

### Olika Scheman per Dag

```yaml
# Skapa events i kalendern:
# - "Morgon" 06:00-08:00 (m√•ndag-fredag)
# - "Arbetstid" 08:00-17:00 (m√•ndag-fredag)
# - "Kv√§ll" 17:00-22:00 (varje dag)
# - "Natt" 22:00-06:00 (varje dag)

automation:
  - alias: "Schema - Morgonrutin"
    id: schedule_morning
    trigger:
      - platform: calendar
        entity_id: calendar.dagschema
        event: start
    condition:
      - condition: template
        value_template: "{{ trigger.calendar_event.summary == 'Morgon' }}"
    action:
      - service: scene.turn_on
        target:
          entity_id: scene.morning

  - alias: "Schema - Nattl√§ge"
    id: schedule_night
    trigger:
      - platform: calendar
        entity_id: calendar.dagschema
        event: start
    condition:
      - condition: template
        value_template: "{{ trigger.calendar_event.summary == 'Natt' }}"
    action:
      - service: scene.turn_on
        target:
          entity_id: scene.night
```

## Soph√§mtning

### Waste Collection Schedule

```yaml
# Med Waste Collection Schedule integration

automation:
  - alias: "Soph√§mtning - P√•minnelse"
    id: waste_reminder
    trigger:
      - platform: calendar
        entity_id: calendar.waste_collection
        event: start
        offset: "-18:00:00"  # Kv√§llen innan
    action:
      - service: notify.all_phones
        data:
          title: "üóëÔ∏è Soph√§mtning imorgon"
          message: "{{ trigger.calendar_event.summary }}"
      - service: tts.speak
        target:
          entity_id: tts.piper
        data:
          media_player_entity_id: media_player.kitchen
          message: "Kom ih√•g att st√§lla ut {{ trigger.calendar_event.summary }} ikv√§ll"
```

## Dynamiska Scheman

### H√§mta Kommande Events

```yaml
template:
  - sensor:
      - name: "N√§sta kalenderevent"
        unique_id: next_calendar_event
        state: "{{ state_attr('calendar.hem', 'message') | default('Inget') }}"
        attributes:
          start: "{{ state_attr('calendar.hem', 'start_time') }}"
          end: "{{ state_attr('calendar.hem', 'end_time') }}"
          location: "{{ state_attr('calendar.hem', 'location') }}"
          description: "{{ state_attr('calendar.hem', 'description') }}"
```

### Automatisk Belysning Baserat p√• Event

```yaml
automation:
  - alias: "Dynamisk belysning per event"
    id: dynamic_lighting_by_event
    trigger:
      - platform: calendar
        entity_id: calendar.hem
        event: start
    action:
      - choose:
          # Filmkv√§ll
          - conditions:
              - condition: template
                value_template: "{{ 'film' in trigger.calendar_event.summary.lower() }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: scene.movie

          # Middag
          - conditions:
              - condition: template
                value_template: "{{ 'middag' in trigger.calendar_event.summary.lower() }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: scene.dinner

          # Fest
          - conditions:
              - condition: template
                value_template: "{{ 'fest' in trigger.calendar_event.summary.lower() }}"
            sequence:
              - service: scene.turn_on
                target:
                  entity_id: scene.party
```

## Google Calendar

### Integration Setup

```yaml
# Via UI: Settings ‚Üí Integrations ‚Üí Google Calendar
# Kr√§ver Google Cloud Console projekt
```

### Filtrera Events

```yaml
automation:
  - alias: "Bara jobbm√∂ten"
    id: work_meetings_only
    trigger:
      - platform: calendar
        entity_id: calendar.work_calendar
        event: start
    condition:
      # Filtrera p√• event-egenskaper
      - condition: template
        value_template: >
          {{ trigger.calendar_event.summary is not none and
             ('m√∂te' in trigger.calendar_event.summary.lower() or
              'meeting' in trigger.calendar_event.summary.lower()) }}
    action:
      - service: light.turn_on
        target:
          entity_id: light.office
```

## Workday Sensor

Kombinera med workday-sensor:

```yaml
# configuration.yaml
binary_sensor:
  - platform: workday
    country: SE
    workdays: [mon, tue, wed, thu, fri]
    excludes: [sat, sun, holiday]
```

```yaml
automation:
  - alias: "Arbetsdag morgon"
    id: workday_morning
    trigger:
      - platform: time
        at: "07:00:00"
    condition:
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: "on"
      # Inte p√• semester
      - condition: state
        entity_id: calendar.semester
        state: "off"
    action:
      - service: scene.turn_on
        target:
          entity_id: scene.workday_morning
```

## Helgdagar

### Svensk Helgdagskalender

```yaml
# Anv√§nd ICS integration med svensk helgdagskalender
# eller workday sensor med country: SE
```

### Anpassa Automationer f√∂r Helgdag

```yaml
automation:
  - alias: "Helgdag - Sov l√§ngre"
    id: holiday_sleep_in
    trigger:
      - platform: time
        at: "09:00:00"  # Senare √§n vanligt
    condition:
      - condition: or
        conditions:
          # L√∂rdag eller s√∂ndag
          - condition: time
            weekday:
              - sat
              - sun
          # Eller r√∂d dag
          - condition: state
            entity_id: binary_sensor.workday_sensor
            state: "off"
    action:
      - service: scene.turn_on
        target:
          entity_id: scene.weekend_morning
```

## M√∂tesrumsbokning

```yaml
automation:
  - alias: "M√∂tesrum - F√∂rbereda"
    id: meeting_room_prepare
    trigger:
      - platform: calendar
        entity_id: calendar.meeting_room
        event: start
        offset: "-00:05:00"
    action:
      - parallel:
          - service: light.turn_on
            target:
              entity_id: light.meeting_room
            data:
              brightness_pct: 100
          - service: climate.set_temperature
            target:
              entity_id: climate.meeting_room
            data:
              temperature: 22
          - service: media_player.turn_on
            target:
              entity_id: media_player.meeting_room_display

  - alias: "M√∂tesrum - St√§da upp"
    id: meeting_room_cleanup
    trigger:
      - platform: calendar
        entity_id: calendar.meeting_room
        event: end
        offset: "00:05:00"  # 5 min efter
    action:
      - service: light.turn_off
        target:
          entity_id: light.meeting_room
      - service: climate.set_preset_mode
        target:
          entity_id: climate.meeting_room
        data:
          preset_mode: away
```

## Exempelprompts

```
"Skapa automation som aktiverar semesterl√§ge fr√•n kalender"

"Jag vill ha en p√•minnelse kv√§llen innan soph√§mtning"

"Konfigurera dynamisk belysning baserat p√• kalenderevent"

"Skapa arbetsschema med olika scener under dagen"

"Integrera Google Calendar med min hemautomation"
```

## Best Practices

1. **Anv√§nd Local Calendar** f√∂r scheman du kontrollerar
2. **Offset triggers** f√∂r f√∂rberedelse/st√§dning
3. **Kombinera med workday** f√∂r helghantering
4. **Filtrera events** med template conditions
5. **Backup** - Exportera kalender regelbundet
6. **Namnkonvention** - Konsistenta eventnamn f√∂r filtrering

## Se √§ven

- `references/automations.md` - Automation patterns
- `references/triggers-advanced.md` - Avancerade triggers
- `references/conditions.md` - Villkor
- `references/presence-detection.md` - N√§rvaro + kalender
